sudo: false

dist: bionic

language: php

php:
    - '7.2'
    - '7.4'

cache:
    directories:
        - $HOME/.composer/cache

before_install:
    - travis_retry composer selfupdate

before_script:
    - if [[ ${TRAVIS_PHP_VERSION:0:3} == "7.4" ]]; then wget https://github.com/infection/infection/releases/download/0.15.1/infection.phar; fi
    - if [[ ${TRAVIS_PHP_VERSION:0:3} == "7.4" ]]; then wget https://github.com/infection/infection/releases/download/0.15.1/infection.phar.asc; fi
    - if [[ ${TRAVIS_PHP_VERSION:0:3} == "7.4" ]]; then chmod +x infection.phar; fi
    - COMPOSER_MEMORY_LIMIT=-1 travis_retry composer install --prefer-dist --no-interaction

script:
    - ./vendor/bin/phpunit --coverage-clover=coverage.xml
    - if [[ ${TRAVIS_PHP_VERSION:0:3} == "7.4" ]]; then ./infection.phar --min-msi=95 --min-covered-msi=100 --threads=4; fi
